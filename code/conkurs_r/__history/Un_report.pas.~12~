unit Un_report;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, StdCtrls, ComCtrls, ExtCtrls, Grids, DBGrids,db,ADODB, Mask, ToolWin,
  ImgList, DBCtrls;

type
  TFrm_report = class(TForm)
    work_user_PC: TPageControl;
    selTab: TTabSheet;
    insTab: TTabSheet;
    upd_tab: TTabSheet;
    delTab: TTabSheet;
    work_condBox: TGroupBox;
    m_work_groper: TGroupBox;
    m_work_dataBox: TGroupBox;
    work_btndBox: TGroupBox;
    m_work_sel_btn: TButton;
    sel_work_cond_edit: TLabeledEdit;
    sel_workGid: TDBGrid;
    sel_work_fnd_edit: TLabeledEdit;
    work_selRadioreset: TRadioButton;
    work_naim_grouper: TRadioButton;
    work_ins_inpBox: TGroupBox;
    work_ntnBox: TGroupBox;
    ins_work_dataBox: TGroupBox;
    work_insBtn: TButton;
    ins_w_work_nain_inp: TLabeledEdit;
    workToolBar: TToolBar;
    showcombtn: TToolButton;
    hidecombtn: TToolButton;
    workImageList: TImageList;
    wr_upd_inp_box: TGroupBox;
    wrk_upd_dataBox: TGroupBox;
    wrkr_upd_btnBox: TGroupBox;
    wrk_upd_Btn: TButton;
    wr_upd_work_lbl: TStaticText;
    wr_upd_DBL: TDBLookupComboBox;
    del_wrk_dataBox: TGroupBox;
    del_wrk_inpBox: TGroupBox;
    del_wrk_btnBox: TGroupBox;
    del_wrk_Btn: TButton;
    del_wrk_kbl: TStaticText;
    del_wrk_DBL: TDBLookupComboBox;
    ins_work_grid: TDBGrid;
    ins_w_opis_inp: TLabeledEdit;
    work_dataLbl: TLabel;
    work_data_inp: TDateTimePicker;
    work_mark_and_about_inp: TLabeledEdit;
    ins_w_usr_Lbl: TLabel;
    ins_w_usr_DBL: TDBLookupComboBox;
    upd_workGrd: TDBGrid;
    commment_inp: TLabeledEdit;
    DelwrkGrid: TDBGrid;
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure FormCreate(Sender: TObject);
    procedure FormActivate(Sender: TObject);
    procedure hidecombtnClick(Sender: TObject);
    procedure wrk_upd_BtnClick(Sender: TObject);
    procedure del_wrk_BtnClick(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Frm_report: TFrm_report;

implementation

uses Un_dm, Un_func, Un_main;

{$R *.dfm}

     //DONE: add work
     //todo:add pass logik
     //todo:add report
     //DONE:hide comment
     // open_comment with  pas

procedure TFrm_report.del_wrk_BtnClick(Sender: TObject);
 var   AreFieldsEmpty: Boolean;
begin
  AreFieldsEmpty:=(
  (del_wrk_DBL.Text='')
  );
  if AreFieldsEmpty then 
  begin
      MessageDlg('Ошибка: одно из полей пустое или текст не прошел проверку.',
    mtError, [mbOK], 0);
    Beep;
    Exit;
  end;
   try
      with dm.del_work do
      begin
        if not Connection.Connected then
          raise Exception.Create('Соединение с базой не установлено');
           Parameters.ParamByName('@id_work').Value
           :=DM.workQuery.FieldByName('id_work').AsString;
           ExecProc;
           dm.workQuery.Close;
           dm.workQuery.Open;
        MessageDlg('Изменения внесены', mtInformation, [mbOK], 0);
      end;
    except
      on E: EADOError do
      begin
        ShowMessage('Ошибка: ' + E.Message);
      end;
      on E: Exception do
      begin
        ShowMessage('Ошибка: ' + E.Message);
      end;
    end;
  
end;

procedure TFrm_report.FormActivate(Sender: TObject);
begin
 dm.muserQuery.Open;
 dm.workQuery.Open;
end;

procedure TFrm_report.FormClose(Sender: TObject; var Action: TCloseAction);
begin
  SaveFormState(Self);
  CloseAllQueriesOnDataModule('dm');
end;

procedure TFrm_report.FormCreate(Sender: TObject);
begin
 Frm_work.KeyPreview:=true;
 Frm_work.ShowHint:=true;
 UniformizeButtonsSize(Self,  273, 25);
 UniformizeDBGrids(Self, 'Arial', 10, clBlack, clWhite);
 UniformizeComponentSizes(Self, 998, 21, clWhite, 'Arial', 10);
 LoadFormState(Self);
 LoadIconFromResource('LOCK',1,workImageList);
 showcombtn.ImageIndex:=0;
 LoadIconFromResource('UNLOCK',1,workImageList);
 hidecombtn.ImageIndex:=1;
 sel_workGid.Columns[4].Visible:=False;
end;

procedure TFrm_report.hidecombtnClick(Sender: TObject);
begin
   sel_workGid.Columns[4].Visible:=False;
end;

end.
